<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Play - C64 Online</title>

  <script src="./js/vc64web_player.js"></script>

  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 16px; }
    .wrap { max-width: 1100px; margin: 0 auto; }
    .box { border: 1px solid #ccc; border-radius: 12px; padding: 12px; margin-bottom: 12px; }
    #p { width: 100%; height: 78vh; background: #000; border-radius: 12px; overflow: hidden; }
    button, a.btn {
      display: inline-block;
      padding: 10px 16px;
      font-weight: 900;
      cursor: pointer;
      border: 1px solid #222;
      border-radius: 10px;
      background: #fff;
      color: #000;
      text-decoration: none;
      margin-right: 8px;
      margin-top: 6px;
    }
    code { font-weight: 900; }
    .small { font-size: 0.95em; opacity: 0.85; }
    .warn { color: #b00020; font-weight: 900; }
  </style>
</head>

<body>
<div class="wrap">
  <div class="box">
    <h2 style="margin:0 0 8px 0;">BANK OF HOPES - C64</h2>

    <div class="small" style="margin:0 0 10px 0;">
      Premi PLAY per iniziare. Il caricamento è automatico.
    </div>

    <div style="margin:0 0 10px 0;">
      <button id="go">PLAY</button>
      <a class="btn" href="./gioco.d64">Scarica D64</a>
    </div>

    <div class="small">
      Se resta su READY, non toccare nulla: il gioco partirà da solo in pochi secondi.
    </div>
  </div>

  <div id="p"></div>
</div>

<script>
  const sleep = (ms) => new Promise(r => setTimeout(r, ms));

  // Digita lentamente per evitare casino con virgolette (specie se l’utente ha warp attivo)
  async function typeSlow(text, perCharMs = 18) {
    for (const ch of text) {
      await action(`${ch}`);
      await sleep(perCharMs);
    }
  }

  async function autorun() {
    await wasm_ready_after_reset();
    await sleep(150);

    // LOAD"*",8,1
    await typeSlow('LOAD"*",8,1', 18);
    await action(`=>Enter`);

    await disk_loading_finished();

    await sleep(150);

    // RUN
    await typeSlow('RUN', 18);
    await action(`=>Enter`);
  }

  document.getElementById("go").addEventListener("click", () => {
    const config = {
      // UI ON così l’utente può aprire Settings / Warp, ecc.
      navbar: true,
      wide: true,
      port2: true,
      border: 0.3,

      // --- MODIFICA: CARICAMENTO AUTOMATICO ROM ---
      // Impostiamo questo a false o lo omettiamo, perchè forniamo noi i file
      dialog_on_missing_roms: false,

      // Qui indichiamo i percorsi dei file .bin sul tuo server
      roms: {
          basic:  "./basic.bin",      // Assicurati di avere questo file
          kernal: "./kernal.bin",     // Assicurati di avere questo file
          char:   "./chargen.bin",    // Assicurati di avere questo file
          d1541:  "./d1541II.bin"     // Il file che hai rinominato tu
      },
      // --------------------------------------------

      // Script di auto-avvio
      buttons: [{
        run: true,
        script: `(${autorun.toString()})();`
      }]
    };

    // Monta il disco automaticamente
    vc64web_player.samesite_file = {
      url: "./gioco.d64",
      name: "gioco.d64"
    };

    vc64web_player.load(
      document.getElementById("p"),
      encodeURIComponent(JSON.stringify(config))
    );
  });
</script>
</body>
</html>
