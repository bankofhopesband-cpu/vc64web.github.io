<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>C64 Web Player</title>
  
  <script src="./vc64web_player.js"></script>
  
  <style>
    body { 
      background-color: #202020; 
      color: #ccc; 
      font-family: monospace; 
      text-align: center; 
      margin: 0; 
      padding-top: 20px;
    }
    
    h1 { margin-bottom: 10px; color: #fff; }

    #c64-container { 
      width: 80%; 
      max-width: 900px; 
      height: 600px; 
      margin: 0 auto; 
      border: 6px solid #444; 
      background: #000; 
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>

  <h1>COMMODORE 64 LOADER</h1>
  <div id="c64-container"></div>
  <p>Attendi il caricamento automatico (LOAD"*",8,1)...</p>

  <script>
    const config = {
      // Impostazioni Grafiche
      navbar: true,
      wide: true,
      port2: true, // Joystick attivo su Porta 2
      
      // Fondamentale: non bloccare se mancano le ROM originali
      dialog_on_missing_roms: false,

      // Qui diciamo all'emulatore di montare il tuo gioco
      samesite_file: { 
          url: "gioco.prg", 
          name: "gioco.prg" 
      },

      // AUTOPILOTA: Scrive i comandi corretti per evitare l'errore UNDEF'D
      buttons: [{
        run: true,
        script: `(async function() {
             const wait = (ms) => new Promise(r => setTimeout(r, ms));
             
             // 1. Aspetta che il motore WASM sia carico e il C64 resettato
             await wasm_ready_after_reset();
             await wait(1500); 

             const type = async(text) => { for(let c of text) { await action(c); await wait(60); } };
             
             // 2. Scrive il comando di caricamento ASSOLUTO
             // Le virgolette e la virgola sono gestite apposta per evitare problemi
             await type('LOAD');
             await action('"');
             await type('*');
             await action('"');
             await action(',');
             await type('8');
             await action(',');
             await type('1'); // <--- QUESTO "1" RISOLVE IL TUO ERRORE!
             
             await action('=>Enter');
             
             // 3. Aspetta il caricamento (aumentato a 3 secondi per sicurezza)
             await wait(3000);
             
             // 4. Lancia il gioco
             await type('RUN'); 
             await action('=>Enter');
        })()`
      }]
    };

    // Avvia l'emulatore dentro il div "c64-container"
    vc64web_player.load(document.getElementById("c64-container"), encodeURIComponent(JSON.stringify(config)));
  </script>

</body>
</html>
