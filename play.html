<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Play – C64 PRG</title>

  <script src="./js/vc64web_player.js"></script>

  <style>
    body{font-family:system-ui,Arial,sans-serif;margin:16px}
    .box{border:1px solid #ccc;border-radius:12px;padding:12px;margin-bottom:12px}
    #emu{width:100%;height:80vh;background:#000;border-radius:12px;overflow:hidden}
    button,a.btn{display:inline-block;padding:10px 16px;font-weight:900;cursor:pointer;border:1px solid #222;border-radius:10px;background:#fff;color:#000;text-decoration:none;margin-right:8px;margin-top:6px}
    code{font-weight:900}
    .warn{color:#b00020;font-weight:900}
    .small{font-size:.95em;opacity:.85}
  </style>
</head>

<body>
  <div class="box">
    <b>Gioco online (PRG)</b><br>
    <div class="small">
      <span class="warn">Prima volta su questo browser:</span> l’emulatore ti chiederà le ROM (BASIC/KERNAL/CHARGEN + 1541).<br>
      Poi non te le chiede più.
    </div>
    <button id="play">PLAY</button>
    <a class="btn" href="./rom.html">Guida ROM</a>
    <a class="btn" href="./gioco.prg">Scarica PRG</a>
    <div class="small" style="margin-top:8px;">
      Se resta su READY: <code>RUN</code>
    </div>
  </div>

  <div id="emu"></div>

<script>
  const sleep = ms => new Promise(r => setTimeout(r, ms));

  async function autorun(){
    await wasm_ready_after_reset();
    await sleep(200);
    await action('RUN=>Enter');
  }

  document.getElementById("play").onclick = () => {
    const config = {
      // IMPORTANTISSIMO: niente openROMS (per compatibilità con VICE)
      openROMS: false,

      // UI ON così puoi entrare in Settings e caricare ROM / settare PAL ecc.
      navbar: true,

      wide: true,
      port2: true,
      border: 0.3,

      // se mancano ROM, mostra dialog
      dialog_on_missing_roms: true,

      buttons: [{
        run: true,
        script: `(${autorun.toString()})();`
      }]
    };

    vc64web_player.samesite_file = {
      url: "./gioco.prg",
      name: "gioco.prg"
    };

    vc64web_player.load(
      document.getElementById("emu"),
      encodeURIComponent(JSON.stringify(config))
    );
  };
</script>
</body>
</html>
